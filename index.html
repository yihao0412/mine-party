<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>è¸©åœ°é›·æ´¾å°éŠæˆ²</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 10px;
  margin: 0;
}

.hidden { display: none; }

.grid {
  display: grid;
  gap: 6px;
  justify-content: center;
  margin: 15px auto;
  max-width: 100vw;
}

.cell {
  border-radius: 8px;
  border: 1px solid #ccc;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
}

.red    { background: #e74c3c; }
.blue   { background: #3498db; }
.green  { background: #2ecc71; }
.orange { background: #f39c12; }

/* æŠ•å½±æ¨¡å¼æ–‡å­— */
body.projector #turn {
  font-size: 36px;
  font-weight: bold;
  margin: 20px 0;
}

/* ä¸­å¤®è¨Šæ¯ */
#message {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0,0,0,0.75);
  color: white;
  padding: 30px 40px;
  border-radius: 16px;
  font-size: 32px;
  z-index: 999;
  pointer-events: none;
}
</style>
</head>

<body>

<!-- ===== ä¸­å¤®è¨Šæ¯ ===== -->
<div id="message" class="hidden"></div>

<!-- ===== è¨­å®šé  ===== -->
<div id="setup">
  <h2>ğŸ® éŠæˆ²è¨­å®š</h2>

  <label>æ£‹ç›¤å¤§å°ï¼š
    <input type="number" id="size" value="7" min="5" max="15">
  </label><br><br>

  <label>åœ°é›·æ•¸é‡ï¼š
    <input type="number" id="mineCount" value="1" min="1">
  </label><br><br>

  <label>è™•ç½°æ ¼æ•¸é‡ï¼š
    <input type="number" id="punishCount" value="3" min="0">
  </label><br><br>

  <label>
    <input type="checkbox" id="projector">
    æŠ•å½±æ¨¡å¼ï¼ˆå¤§è¢å¹•ï¼‰
  </label>

  <hr>

  <h3>ğŸ‘¥ åƒåŠ è€…ï¼ˆæœ€å¤š 30 ä½ï¼‰</h3>
  <div id="players"></div>
  <button onclick="addPlayer()">ï¼‹ æ–°å¢åƒåŠ è€…</button>

  <hr>

  <h3>ğŸ¨ é¡è‰²èªªæ˜</h3>
  ğŸ”´ è¸©åˆ°é›·ï¼ˆç²å‹ï¼‰<br>
  ğŸ”µ é›·çš„ä¸Šä¸‹å·¦å³<br>
  ğŸŸ¢ å®‰å…¨æ ¼<br>
  ğŸŸ  è™•ç½°æ ¼

  <br><br>
  <button onclick="startGame()">â–¶ é–‹å§‹éŠæˆ²</button>
</div>

<!-- ===== éŠæˆ²é  ===== -->
<div id="game" class="hidden">
  <div id="turn"></div>
  <div id="grid" class="grid"></div>
  <button onclick="backToSetup()">â¬… å›åˆ°è¨­å®š</button>
</div>

<script>
let size, mineSet, punishSet, used;
let players = [];
let turnIndex = 0;

// é è¨­ 2 äºº
addPlayer(); addPlayer();

function addPlayer() {
  if (document.querySelectorAll("#players input").length >= 30) return;
  const input = document.createElement("input");
  input.placeholder = "åƒåŠ è€…åç¨±";
  document.getElementById("players").appendChild(input);
}

function startGame() {
  size = +document.getElementById("size").value;
  const mineCount = +document.getElementById("mineCount").value;
  const punishCount = +document.getElementById("punishCount").value;

  players = [...document.querySelectorAll("#players input")]
    .map(i => i.value.trim()).filter(v => v);

  if (players.length === 0) {
    alert("è‡³å°‘è¦ä¸€ä½åƒåŠ è€…");
    return;
  }

  document.body.classList.toggle(
    "projector",
    document.getElementById("projector").checked
  );

  mineSet = new Set();
  punishSet = new Set();
  used = new Set();
  turnIndex = 0;

  while (mineSet.size < mineCount) mineSet.add(randPos());
  while (punishSet.size < punishCount) {
    const p = randPos();
    if (!mineSet.has(p)) punishSet.add(p);
  }

  document.getElementById("setup").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");

  drawGrid();
  updateTurn();
}

function drawGrid() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";
  grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;

  // ğŸ”‘ å‹•æ…‹è¨ˆç®—æ ¼å­å°ºå¯¸ï¼ˆè§£æ±ºè£åˆ‡ï¼‰
  const maxWidth = window.innerWidth * 0.95;
  const maxHeight = window.innerHeight * 0.6;
  const cellSize = Math.floor(
    Math.min(maxWidth / size, maxHeight / size)
  );

  for (let i = 0; i < size * size; i++) {
    const btn = document.createElement("button");
    btn.className = "cell";
    btn.style.width = btn.style.height = cellSize + "px";

    // ğŸ”¹ è‡ªå‹•å­—é«”å¤§å°ï¼Œè·Ÿæ ¼å­å¤§å°æ¯”ä¾‹ 45%
    btn.style.fontSize = Math.floor(cellSize * 0.45) + "px";

    btn.textContent = i + 1;
    btn.onclick = () => pick(i);
    grid.appendChild(btn);
  }
}

function pick(i) {
  if (used.has(i)) return;
  used.add(i);

  const r = Math.floor(i / size);
  const c = i % size;
  const key = `${r},${c}`;
  const btn = document.getElementsByClassName("cell")[i];
  const name = players[turnIndex];

  if (mineSet.has(key)) {
    btn.classList.add("red");
    showMessage(`ğŸ‰ æ­å–œ ${name} è¸©åˆ°åœ°é›·ï¼`);
    nextTurn();
    return;
  }

  if (punishSet.has(key)) {
    btn.classList.add("orange");
    showMessage(`ğŸ˜ˆ ${name} è¸©åˆ°è™•ç½°æ ¼ï¼`);
    nextTurn();
    return;
  }

  const adj = [
    `${r-1},${c}`,`${r+1},${c}`,`${r},${c-1}`,`${r},${c+1}`
  ];
  btn.classList.add(adj.some(a => mineSet.has(a)) ? "blue" : "green");
  nextTurn();
}

function nextTurn() {
  turnIndex = (turnIndex + 1) % players.length;
  updateTurn();
}

function updateTurn() {
  document.getElementById("turn").textContent =
    `ğŸ‘‰ è¼ªåˆ°ï¼š${players[turnIndex]}`;
}

function showMessage(text) {
  const m = document.getElementById("message");
  m.textContent = text;
  m.classList.remove("hidden");
  setTimeout(() => m.classList.add("hidden"), 2500);
}

function backToSetup() {
  document.getElementById("game").classList.add("hidden");
  document.getElementById("setup").classList.remove("hidden");
  document.body.classList.remove("projector");
}

function randPos() {
  return `${Math.floor(Math.random()*size)},${Math.floor(Math.random()*size)}`;
}
</script>

</body>
</html>