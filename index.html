<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¸©åœ°é›·æ´¾å°éŠæˆ²ï¼ˆéš¨æ©Ÿåœ°é›·+è™•ç½°æ ¼+èªªæ˜ï¼‰</title>

<style>
body {
  font-family: Arial, "Microsoft JhengHei", sans-serif;
  text-align: center;
  background: #f0f8ff;
}
#board {
  display: grid;
  gap: 6px;
  justify-content: center;
  margin-top: 20px;
}
button.cell {
  width: 48px;
  height: 48px;
  font-size: 14px;
  font-weight: bold;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}
.red { background: #ff4d4d; }    /* åœ°é›· */
.blue { background: #4da6ff; }   /* åœ°é›·ä¸Šä¸‹å·¦å³ */
.green { background: #4dff88; }  /* å®‰å…¨ */
.orange { background: #ffb84d; } /* è™•ç½°æ ¼ */
button:disabled { opacity: 0.9; cursor: not-allowed; }
.panel { margin-top: 10px; text-align: center; }
.hidden { display: none; }
h2 { margin-top: 20px; color: #333; }
#restartPanel { margin-top: 20px; }
.colorLegend { margin-top: 15px; text-align: left; display: inline-block; font-size: 14px; }
.colorBox {
  display: inline-block;
  width: 18px;
  height: 18px;
  vertical-align: middle;
  margin-right: 6px;
  border-radius: 4px;
}
</style>
</head>

<body>

<h2>ğŸ‰ è¸©åœ°é›·æ´¾å°éŠæˆ²</h2>
<p>ä¸»æŒäººè¨­å®šæ£‹ç›¤å¤§å°ã€åœ°é›·æ•¸é‡èˆ‡è™•ç½°æ ¼æ•¸é‡ï¼Œé–‹å§‹éŠæˆ²å¾Œç©å®¶åªèƒ½çœ‹æ£‹ç›¤ï¼</p>

<!-- ä¸»æŒäººè¨­å®šå€ -->
<div id="setup" class="panel">
  æ£‹ç›¤å¤§å°ï¼š
  <input type="number" id="size" value="7" min="3" max="15"><br><br>

  åœ°é›·æ•¸é‡ï¼š
  <input type="number" id="mineCount" value="5" min="1" max="20"><br><br>

  è™•ç½°æ ¼æ•¸é‡ï¼š
  <input type="number" id="penaltyCount" value="3" min="0" max="10"><br><br>

  <button onclick="startGame()">ğŸ¬ é–‹å§‹éŠæˆ²</button>

  <!-- é¡è‰²èªªæ˜ -->
  <div class="colorLegend">
    <p><span class="colorBox" style="background:#ff4d4d;"></span>ğŸ”´ è¸©åˆ°é›·</p>
    <p><span class="colorBox" style="background:#4da6ff;"></span>ğŸ”µ é›·ä¸Šä¸‹å·¦å³</p>
    <p><span class="colorBox" style="background:#4dff88;"></span>ğŸŸ¢ å®‰å…¨</p>
    <p><span class="colorBox" style="background:#ffb84d;"></span>ğŸŸ  è™•ç½°æ ¼</p>
  </div>
</div>

<!-- ç©å®¶éŠæˆ²å€ -->
<div id="game" class="hidden">
  <div id="board"></div>
  <div id="restartPanel" class="hidden">
    <button onclick="backToSetup()">ğŸ” å›åˆ°è¨­å®šç•«é¢</button>
  </div>
</div>

<script>
let size = 7;
let mineSet = new Set();
let penaltySet = new Set();
let used = new Set();

function startGame() {
  size = parseInt(document.getElementById("size").value);
  const mineCount = parseInt(document.getElementById("mineCount").value);
  const penaltyCount = parseInt(document.getElementById("penaltyCount").value);

  used.clear();
  mineSet.clear();
  penaltySet.clear();

  // éš¨æ©Ÿç”Ÿæˆåœ°é›·
  while (mineSet.size < mineCount) {
    const r = Math.floor(Math.random() * size);
    const c = Math.floor(Math.random() * size);
    mineSet.add(`${r},${c}`);
  }

  // éš¨æ©Ÿç”Ÿæˆè™•ç½°æ ¼ï¼ˆä¸èƒ½å’Œåœ°é›·é‡ç–Šï¼‰
  while (penaltySet.size < penaltyCount) {
    const r = Math.floor(Math.random() * size);
    const c = Math.floor(Math.random() * size);
    const key = `${r},${c}`;
    if (!mineSet.has(key)) {
      penaltySet.add(key);
    }
  }

  document.getElementById("setup").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  document.getElementById("restartPanel").classList.add("hidden");

  buildBoard();
}

function buildBoard() {
  const board = document.getElementById("board");
  board.innerHTML = "";
  board.style.gridTemplateColumns = `repeat(${size}, 50px)`;

  for (let i = 0; i < size * size; i++) {
    const btn = document.createElement("button");
    btn.className = "cell";
    btn.textContent = i + 1;
    btn.onclick = () => pick(i);
    board.appendChild(btn);
  }
}

function pick(i) {
  if (used.has(i)) return;
  used.add(i);

  const r = Math.floor(i / size);
  const c = i % size;
  const key = `${r},${c}`;
  const btn = document.getElementsByClassName("cell")[i];

  // è¸©åˆ°åœ°é›·
  if (mineSet.has(key)) {
    btn.classList.add("red");
    btn.disabled = true;
    alert("ğŸ‰ ä½ è¸©åˆ°åœ°é›·ï¼Œç²å‹ï¼");
    document.getElementById("restartPanel").classList.remove("hidden");
    return;
  }

  // è¸©åˆ°è™•ç½°æ ¼
  if (penaltySet.has(key)) {
    btn.classList.add("orange");
    btn.disabled = true;
    alert("âš ï¸ ä½ è¸©åˆ°è™•ç½°æ ¼ï¼");
    document.getElementById("restartPanel").classList.remove("hidden");
    return;
  }

  // å®‰å…¨æ ¼é¡è‰²åˆ¤æ–·
  const adj = [
    `${r-1},${c}`, `${r+1},${c}`,
    `${r},${c-1}`, `${r},${c+1}`
  ];

  if (adj.some(a => mineSet.has(a))) {
    btn.classList.add("blue");
  } else {
    btn.classList.add("green");
  }

  btn.disabled = true;
}

// å›åˆ°è¨­å®šç•«é¢
function backToSetup() {
  document.getElementById("game").classList.add("hidden");
  document.getElementById("setup").classList.remove("hidden");
}
</script>

</body>
</html>